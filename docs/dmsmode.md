<!---
NOTE:
If you're reading this, instead try opening README.html in a web browser 
or view this file from within the github repository website.

This is a github-flavored markdown file not meant to be easily readable.
-->

DMS mode
========

Overview
--------
The --dms option, added in v2.2, provides customized analyses and outputs
for DMS-MaP experiments. Unlike SHAPE reagents, which react relatively
uniformly with all four RNA nucleotides, DMS preferentially reacts with A and C nucleotides.
Traditionally, it has been thought that DMS *only* reacts with A and C, but
we have shown that it also reacts in a structurally informative way with U and G.
The --dms mode is optimized to measure DMS reactivities from all four
bases and normalize them to a consistent scale, as one would expect from a SHAPE
experiment. Under common scenarios, DMS-MaP experiments performed using
optimizied protocols and the --dms mode (together named enhanced DMS-MaP, or eDMS-MaP)
outperform SHAPE-MaP experiments at all four nucleotides.

When running with the --dms flag, ShapeMapper will generate normalized 
.dms files in place of .shape files, and will also generate specialized
profiles.pdf and histograms.pdf plots. DMS-specific quality checks are 
also performed, ensuring that U and G modification rates are high enough to 
be useful. 


Probing conditions
------------------
Appropriate buffering conditions are required to support robust U and G modification. 
Optimized Bicine buffer conditions are described in Mustoe et al, PNAS 2019, and 
Mitchell et al, XX. 

ShapeMapper --dms will automatically check for sufficient modification at U and G.
If modification rates at one or both nucleotides are too low (for example, because
of insufficient buffering capacity), then ShapeMapper will throw a warning and mask out all nts
from downstream analyses. In this scenario, other nucleotides types (particularly A and C) may still
contain usable data and will be reported.


MaP enzmye choice
-----------------
The pipeline is optimized for datasets collected using the MarathonRT enzyme, which we 
recommend. But --dms analysis also benefits datasets collected using TGIRT-III and
SuperScript II. 


Mutation type filtering
-----------------------
DMS reacts with the A-N1, C-N3, U-N3, and G-N1 and G-N7. G-N7 modifications occur with
much greater frequency that G-N1, but only G-N1 modification contain information on
RNA secondary structure. Fortunately, G-N1 modifications are preferentially encoded
and G->C and G->U mismatches during MaP-RT, whereas G-N7 are encoded as G->A 
mismatches. ShapeMapper --dms filters out G->A mismatches to permit
highly specific measurement of G structure. ShapeMapper --dms also filters out
indels at all positions (i.e. only mismatches are counted), which contain less
information than mismatches.


Normalization
-------------
DMS reactivities are normalized independently for each nucleotide type (A, C, G, U)
to comparable scales of [0, ~2]. DMS reactivities have a steeper dependence on
structure than SHAPE reactivities: Whereas for SHAPE > 0.85 is considered highly reactive, 
for DMS >0.5 is considered highly reactive and indicative of single-stranded nucleotide.


Structure modeling
------------------
We recommend using the `Fold` or `Partition` module of [RNAstructure](https://rna.urmc.rochester.edu/RNAstructure.html) 
to perform structure modeling. 

We have developed structure modeling parameters that are optimized for the normalized .dms reactivities
generated by ShapeMapper --dms. These parameter files are distributed in... [TODO]




Citation and reference
----------------------

Please cite Mitchell et al, XXX, for publications using the --dms option

Bicine buffering conditions were first described in Mustoe et al, PNAS 2019

